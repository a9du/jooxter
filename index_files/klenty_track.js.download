var BASE_URL="https://plugin.klenty.com/api/sitetracking/";var GET="GET";var POST="POST";var API_KEY="x-api-key";var KlentyAPI=function(api_key,url){this.api_key=api_key;this.base_url=url?url:BASE_URL};KlentyAPI.prototype.load=function(){var self=this;var url=self.base_url+"loadpage";var headers=new Object;headers[API_KEY]=self.api_key;var payload=getPageDetails();return httpGet(url,headers,payload)};KlentyAPI.prototype.init=function(){var self=this;var url=self.base_url+"getLinkDetails";var headers=new Object;headers[API_KEY]=self.api_key;var payload={keyId:window.__kl__tr__Id};var newUrl=httpGet(url,headers,payload);return newUrl};KlentyAPI.prototype.onAction=function(actionName){var self=this;var url=self.base_url+"onActions/";var headers=new Object;var payload={action:actionName};headers[API_KEY]=self.api_key;return httpGet(url,headers,payload)};KlentyAPI.prototype.onFormSubmit=function(objProspect,formName){var self=this;var url=self.base_url+"formSubmit/";var headers=new Object;headers[API_KEY]=self.api_key;var payload=new Object;payload.formName=formName;payload.prospect=objProspect;return httpPost(url,headers,payload)};function getPageDetails(){var objPageDetails=new Object;objPageDetails.title=document.title;objPageDetails.url=document.URL;return objPageDetails}function httpGet(url,headers,payload){var oReq=new XMLHttpRequest;oReq.addEventListener("load",reqListener);if(payload){url=encodeURI(url+"?"+payloadToQuery(payload))}oReq.open(GET,url);if(headers){for(header in headers){oReq.setRequestHeader(header,headers[header])}}oReq.withCredentials=true;return oReq.send()}function reqListener(e){if(!!JSON.parse(e.target.responseText).status&&!!JSON.parse(e.target.responseText).data.domain){kl.base_url=JSON.parse(e.target.responseText).data.domain;kl.load()}return e}function httpPost(url,headers,payload){var oReq=new XMLHttpRequest;oReq.addEventListener("load",reqListener);oReq.open(POST,url);oReq.setRequestHeader("Content-Type","application/json;charset=UTF-8");if(headers){for(header in headers){oReq.setRequestHeader(header,headers[header])}}oReq.withCredentials=true;return oReq.send(JSON.stringify(payload))}function payloadToQuery(payload){var query=Object.keys(payload).map(function(key){return key+"="+payload[key]});return query.join("&")}kl=new KlentyAPI(window.__kl__tr__Id);kl.init();